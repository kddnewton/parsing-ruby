<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Parsing Ruby</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style type="text/css">
body {
  --primary-color: #9b1c16;
  --secondary-color: darkslategray;

  font-family: Verdana, sans-serif;
  margin: 0;
}

.container {
  height: 100vh;
  width: 100vw;
}

.header {
  display: flex;
  padding: 2em;
}

.header--ruby {
  margin-right: 2em;
}

.header--title {
  color: var(--secondary-color);
  font-weight: normal;
}

.timeline--container {
  align-items: center;
  display: flex;
  justify-content: center;
  height: 100%;
  width: 100vw;
}

.timeline {
  background-color: var(--secondary-color);
  height: 2px;
  position: relative;
  width: 100%;
}

.timeline--entry {
  position: relative;
}

.timeline--marker {
  bottom: -2px;
  position: absolute;
  height: 1.5em;
  stroke: var(--primary-color);
  width: 1.5em;
}

.timeline--tick {
  position: relative;
}

.timeline--tick::after {
  background-color: var(--secondary-color);
  content: "";
  height: 10px;
  position: absolute;
  transform: translateY(-40%);
  width: 1px;
}
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
const { useContext, useReducer } = React;

const Marker = () => (
  <svg viewBox="-1 -1 136 117" version="1.1" xmlns="http://www.w3.org/2000/svg" className="timeline--marker">
    <g fill="none">
      <g strokeWidth="6">
        <path d="M24.2479013,0.221260022 L0.452034891,46.3285725 L24.2479013,0.221260022 Z" />
        <path d="M0.452034891,46.3285725 L67.079193,114.413094 L0.452034891,46.3285725 Z" />
        <path d="M67.079193,114.413094 L133.706351,46.3285725 L67.079193,114.413094 Z" />
        <path d="M109.466768,0.221260022 L133.706351,46.3285725 L109.466768,0.221260022 Z" />
        <path d="M109.910485,0.221260022 L24.6916175,0.221260022 L109.910485,0.221260022 Z" />
      </g>
      <path d="M0.452668771,46 L133.704872,46" strokeWidth="3"></path>
      <g strokeWidth="3">
        <path d="M24.2479013,0.221260022 L37.2276568,46.3285725" />
        <path d="M67.0802494,114.412462 L37.2266004,46.3279412" />
        <path d="M67.0802494,0.221260022 L37.2266004,46.3285725" />
        <path d="M109.910485,0.221260022 L96.9307291,46.3285725" />
        <path d="M67.0802494,114.412462 L96.9317856,46.3279412" />
        <path d="M67.0802494,0.221260022 L96.9317856,46.3285725" />
      </g>
    </g>
  </svg>
);

const GitHub = () => (
  <a href="https://github.com/kddnewton/parsing-ruby" style={{ position: "absolute", top: 0, right: 0 }}>
    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 250 250" fill="white">
      <path d="M0 0l115 115h15l12 27 108 108V0z" fill="var(--secondary-color)" />
      <path d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style={{ transformOrigin: "130px 106px" }} />
      <path d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z" />
    </svg>
  </a>
);

const Ruby = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="10em" height="10em" viewBox="0 0 300 300" className="header--ruby">
    <g transform="translate(0 300) scale(.1 -.1)">
      <path fill="#9b1c16" d="m2110 2980l-365-5-335-138-335-138-374-372-375-372-122-281-122-280-22-385-22-384 61-205c34-112 65-208 69-212 5-5 119-53 254-107l246-98 1088 75c599 41 1093 78 1098 83 4 4 28 454 52 1001 24 546 50 1088 57 1203 8 116 11 215 8 221s-102 99-219 207c-192 177-216 197-245 195-18-1-196-5-397-8zm340-34c0-8-360-208-368-204-5 1-66 46-136 98l-127 95 263 5c145 3 287 7 316 8 28 1 52 0 52-2zm257-168c97-89 171-164 166-165-9-3-713 104-718 109-3 3 365 217 374 218 1 0 82-73 178-162zm-800 40c81-61 149-112 151-113 2-2-50-171-114-377l-116-374-370-344c-203-190-392-365-419-389l-50-44-361-83c-199-46-362-83-363-81-7 8-138 364-138 372 0 5 52 131 116 278l116 268 371 367 372 367 321 132c177 73 325 132 329 133 3 0 73-50 155-112zm663-203c200-31 365-57 366-58 1-2-24-414-28-459-3-25-27-7-370 270-202 164-370 301-375 305-4 5 3 6 17 3s189-31 390-61zm-84-257c305-247 381-314 363-315-13-2-224-19-469-38s-459-36-476-38c-30-3-31-1-23 23 22 65 209 671 209 675 0 3 2 5 5 5s179-141 391-312zm404-351c0-8-242-523-249-530-4-4-170 95-369 220-297 188-356 229-334 232 15 2 230 20 477 41 248 21 456 38 463 39 6 0 12-1 12-2zm-22-840c-18-411-35-747-38-747s-40 228-83 506l-78 506 113 243c62 134 114 243 115 241 1-1-12-338-29-749zm-897 198c74-294 132-535 129-534-30 3-1042 336-1042 342 0 9 762 725 772 726 3 1 67-240 141-534zm277 300c196-124 358-230 360-234 2-5-102-139-230-298l-234-289-129 510c-71 281-130 517-133 524-2 6-1 12 2 12s167-101 364-225zm477-849c47-303 85-558 85-568 0-12-107 77-317 263-175 154-318 286-318 293 0 17 459 585 463 572 1-6 40-258 87-560zm-2551 321l56-149-71-129c-39-72-73-129-74-127-3 4 28 558 31 555 1-1 27-69 58-150zm794-29c-9-44-291-1003-297-1010s-381 846-382 867c0 8 623 161 670 164 9 1 12-7 9-21zm605-150c279-89 507-165 507-169 0-8-605-479-617-479-4 0-99 182-211 405-111 223-199 405-194 405 4 0 235-73 515-162zm-157-675c-2-3-152-52-333-109-180-57-340-108-355-113-19-7-26-6-23 2 3 7 70 237 150 512s148 507 151 515c4 9 92-157 210-394 113-224 203-410 200-413zm-957 179c94-216 171-395 171-396 0-2-97 35-216 82l-216 87 5 35c3 19 18 171 34 337 23 253 29 297 39 275 6-15 89-204 183-420zm-259 166c-12-134-25-253-29-266-5-18-17 13-49 122l-43 146 68 124c37 68 70 122 72 120 2-1-7-112-19-246zm2259-143c311-275 317-280 282-282-74-5-1216 82-1212 92 6 15 595 474 604 471 5-1 152-127 326-281zm-399-277c267-18 475-34 464-36-25-3-1678-120-1681-118-1 1 134 45 300 98 279 90 307 97 367 94 36-2 283-19 550-38z"/>
    </g>
  </svg>
);

const Header = () => (
  <header className="header">
    <GitHub />
    <Ruby />
    <h1 className="header--title">The History of<br />Parsing Ruby</h1>
  </header>
);

// type Entry = { date: Date, title: string, description: string, link: string }

const initialState = {
  startDate: new Date(Date.UTC(1995, 0, 1)),
  endDate: new Date()
};

const reducer = (state, action) => {
  return state;
};

const TimelineContext = React.createContext(initialState);

const Timeline = ({ children }) => {
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <TimelineContext.Provider value={state}>
      <div className="timeline--container">
        <div className="timeline">
          <TimelineTicks />
          {children}
        </div>
      </div>
    </TimelineContext.Provider>
  );
};

const getTimelinePercentage = (startDate, endDate, date) => {
  return (date - startDate) / (endDate - startDate) * 100;
};

const TimelineTicks = () => {
  const { startDate, endDate } = useContext(TimelineContext);

  if ((endDate - startDate) >= 3 * 365 * 24 * 60 * 60 * 1000) {
    return <TimelineYearTicks />;
  }

  if ((endDate - startDate) >= 3 * 30 * 24 * 60 * 60 * 1000) {
    return <TimelineMonthTicks />;
  }

  return <TimelineDayTicks />;
};

const TimelineYearTicks = () => {
  const { startDate, endDate } = useContext(TimelineContext);

  const minimum = startDate.getUTCFullYear() + 1;
  const maximum = endDate.getUTCFullYear();

  return new Array(maximum - minimum).fill().map((_value, index) => {
    const year = minimum + index;

    return (
      <TimelineTick key={year} date={new Date(Date.UTC(year, 0, 1))}>
        {year}
      </TimelineTick>
    );
  });
};

const TimelineMonthTicks = () => {
  throw "Not yet implemented";
};

const TimelineDayTicks = () => {
  throw "Not yet implemented";
};

const TimelineTick = ({ children, date }) => {
  const { startDate, endDate } = useContext(TimelineContext);
  const percentage = getTimelinePercentage(startDate, endDate, date);

  return <div className="timeline--tick" style={{ left: `${percentage}%` }} />;
};

const TimelineEntry = ({ children, date, title }) => {
  const { startDate, endDate } = useContext(TimelineContext);

  if (startDate > date || endDate < date) {
    return null;
  }

  const percentage = getTimelinePercentage(startDate, endDate, date);

  return (
    <div className="timeline--entry" style={{ left: `${percentage}%` }}>
      <Marker />
    </div>
  );
};

const TimelineLink = ({ href }) => (
  <a href={href}>&#f35d;</a>
);

const App = () => (
  <div className="container">
    <Header />
    <Timeline>
      <TimelineEntry date={new Date(Date.UTC(2016, 9, 10))} title="Soutaro Matsumoto releases v0.1.0 of querly">
        <TimelineLink href="https://github.com/soutaro/querly" />
        Uses the `parser` gem to find method calls with configured rules
      </TimelineEntry>
      <TimelineEntry date={new Date(Date.UTC(2016, 11, 25))} title="Ruby 2.4.0" />
      <TimelineEntry date={new Date(Date.UTC(2017, 11, 25))} title="Ruby 2.5.0">
        <TimelineLink href="https://www.ruby-lang.org/en/news/2017/12/25/ruby-2-5-0-released/" />
        `rescue` and `ensure` at the block and method level
      </TimelineEntry>
      <TimelineEntry date={new Date(Date.UTC(2018, 11, 25))} title="Ruby 2.6.0">
        `RubyVM::AbstractSyntaxTree`
      </TimelineEntry>
      <TimelineEntry date={new Date(Date.UTC(2019, 11, 25))} title="Ruby 2.7.0" />
      <TimelineEntry date={new Date(Date.UTC(2020, 11, 25))} title="Ruby 3.0.0" />
    </Timeline>
  </div>
);

ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
